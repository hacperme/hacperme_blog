---
title: "USB 知识笔记"
date: 2024-07-18T01:31:42+08:00
lastmod: 2024-07-18T01:31:42+08:00
author: ["hacper"]
tags:
    - Linux
    - USB
categories:
    - 笔记
description: "" # 文章描述，与搜索优化相关
summary: "" # 文章简单描述，会展示在主页
# weight: # 输入1可以顶置文章，用来给文章展示排序，不填就默认按时间排序
slug: ""
draft: true # 是否为草稿
comments: true
showToc: true # 显示目录
TocOpen: true # 自动展开目录
autonumbering: true # 目录自动编号
hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等
disableShare: true # 底部不显示分享栏
searchHidden: false # 该页面可以被搜索到
showbreadcrumbs: true #顶部显示当前路径
# mermaid: true

---

## 设计 USB 接口的目的

设计USB接口的主要目的包括：

1. **统一标准**：
   - USB接口的设计旨在提供一个统一的标准，取代过去各种不同的接口（如串口、并口、PS/2等），简化连接和接口类型，方便用户使用。

2. **即插即用**：
   - 提供即插即用的功能，使用户无需重启计算机或进行复杂的设置就能使用新设备，大大提高了设备的易用性。

3. **高效的数据传输**：
   - 设计高效的数据传输协议，支持不同速度的传输模式（如低速、全速、高速和超高速），满足各种设备的性能需求。

4. **电力供应**：
   - 通过USB接口供电，使一些外部设备（如键盘、鼠标、U盘等）无需额外的电源适配器，简化了设备的使用。

5. **热插拔功能**：
   - 支持热插拔，使用户可以在不关闭设备电源的情况下插拔USB设备，提高了使用的灵活性和便利性。

6. **扩展性**：
   - 设计支持通过集线器扩展多个USB设备，提升了接口的扩展性，满足更多设备连接的需求。

## USB 的发展和特点


| 版本       | 发布年份 | 传输速率        | 主要特点                                                      |
|------------|----------|-----------------|-------------------------------------------------------------|
| **USB 1.0**| 1996     | 1.5 Mbps（低速）和12 Mbps（全速） | 最早的USB标准，主要用于低速设备如键盘和鼠标                 |
| **USB 1.1**| 1998     | 1.5 Mbps和12 Mbps| 修正了USB 1.0的一些问题，提高了兼容性和稳定性               |
| **USB 2.0**| 2000     | 480 Mbps（高速） | 大幅提升传输速率，广泛应用于U盘、外部硬盘、打印机等设备，向下兼容USB 1.x设备 |
| **USB 3.0**| 2008     | 5 Gbps（超高速） | 增加了更多传输通道（双向传输），提升了数据传输效率，蓝色插头和连接器以区分USB 2.0 |
| **USB 3.1**| 2013     | 10 Gbps（超级速度+） | 进一步提升传输速率，并引入了新的Type-C接口标准             |
| **USB 3.2**| 2017     | 10 Gbps和20 Gbps（双通道） | 引入多通道技术，提升传输速度和带宽，全面支持Type-C接口      |
| **USB4**   | 2019     | 最高40 Gbps      | 基于Thunderbolt 3协议，提供更高的传输速率和更好的数据传输性能，支持多种协议（如PCIe和DisplayPort），并完全采用Type-C接口 |
| **USB Type-C** | -       | -               | 可逆设计，支持多种协议（如USB 3.x、USB4、Thunderbolt 3等），高功率传输（支持USB PD协议，提供高达100W的功率） |

## USB 的拓扑结构和特点

USB的拓扑结构是树形（star topology）结构，这种结构使得设备可以通过多个层次的集线器（HUB）连接到主机。

```
                          主机（Host）
                             |
                         根集线器（Root Hub）
                        /    |     \    \
                       /     |      \    \
                 设备1  集线器1（Hub1） 设备2  设备3
                           /  |  \
                          /   |   \
                    设备4  设备5  集线器2（Hub2）
                                    /   \
                                   /     \
                             设备6  设备7

```

### USB拓扑结构
- 根集线器（Root Hub）：

    每个USB系统有一个根集线器，通常集成在主控制器（Host Controller）中。
    根集线器直接连接到主机，并为主机提供多个端口，用于连接USB设备或下级集线器。

- 集线器（Hub）：

    集线器用于扩展连接能力，每个集线器有一个上行端口（连接到上一级集线器或根集线器）和多个下行端口（连接到设备或下一级集线器）。
    集线器可以级联，最多支持5级集线器（包括根集线器）。

- 设备（Device）：

    设备可以是任何USB外围设备，如键盘、鼠标、打印机、U盘等。
    设备通过集线器的下行端口连接到主机。

### 拓扑结构特点


- 树形结构：

    USB拓扑结构呈树形，主机位于树的根部，通过根集线器连接多个设备和集线器。
    这种结构便于扩展，通过增加集线器可以连接更多的设备。

- 最多层级：

    USB规范规定，从根集线器到设备的最大层级数为5级，包括根集线器。
    这意味着从主机到最远的设备最多可以经过4个集线器。

- 端口数量：

    每个集线器可以有多个下行端口，一般为4到7个，具体数量取决于集线器的设计。

- 电源管理：

    集线器和设备可以通过USB供电。高功率设备可能需要自带电源适配器，而低功率设备（如鼠标、键盘）可以直接从USB端口获取电力。

- 即插即用：

    USB支持即插即用，用户可以在不关闭主机电源的情况下插拔设备，操作系统会自动识别并配置设备。


![](https://github.com/hacperme/picx-images-hosting/raw/master/image.4uatmapz59.webp)

- USB 连接
     USB 连接指的就是连接 USB 设备和主机（或 Hub）的四线电缆。电缆中包括 VBUS（电源线）、GND（地线）和两根信号线。USB 系统就是通过 VBUS 和 GND 向 USB 设备提供电源的。主机对连接的 USB 设备提供电源供其使用，而每个 USB 设备也能够有自己的电源。
     ![](https://github.com/hacperme/picx-images-hosting/raw/master/image.5tqwzh83ns.webp)

- USB Host Controller （USB 主机控制器）
    控制所有的 USB 设备的通信，一个 USB 控制器和一个 Hub 绑定在一起，专业一点称为“集成”，而这个Hub 也被称做 Root Hub。

- USB 设备
    USB 设备包括了 Hub 和功能设备

#### Composite Device（组合设备）和 Compound Device（复合设备）

![](https://github.com/hacperme/picx-images-hosting/raw/master/image.99t8rkp9p3.webp)

在USB术语中，Compound Device（复合设备）和 Composite Device（组合设备）都是指含有多个功能的USB设备，但它们有不同的架构和特点。以下是它们的差异和特点：

| 特点               | Composite Device（组合设备）          | Compound Device（复合设备）       |
|--------------------|--------------------------------------|-----------------------------------|
| **USB地址**        | 共享一个USB地址                       | 每个功能设备有独立的USB地址        |
| **内部结构**       | 多个接口共享同一个USB设备             | 包含一个内部集线器和多个功能设备   |
| **管理和控制**     | 简单，因为所有功能共享同一个地址      | 复杂，因为每个功能设备独立管理     |
| **设备描述符**     | 一个设备描述符，多个接口描述符        | 每个功能设备有独立的设备描述符     |
| **应用示例**       | 键盘和触摸板的组合设备                | 多功能打印机                       |


